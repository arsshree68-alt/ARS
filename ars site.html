<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE ARS PLAYGROUND</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            min-width: 400px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-container h2 {
            margin-bottom: 30px;
            color: #2c3e50;
            font-size: 2rem;
        }

        .auth-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        .auth-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .auth-btn {
            width: 100%;
            padding: 15px 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 20px;
            transition: opacity 0.3s ease;
        }

        .auth-btn:hover {
            opacity: 0.9;
        }

        .auth-links {
            margin-top: 15px;
        }

        .auth-links a {
            color: #667eea;
            text-decoration: none;
            margin: 0 10px;
            font-weight: 600;
        }

        .auth-links a:hover {
            text-decoration: underline;
        }

        .error-message, .success-message {
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        .error-message {
            background-color: #fee;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .success-message {
            background-color: #f0fff4;
            color: #38a169;
            border: 1px solid #9ae6b4;
        }

        .user-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 1000;
            display: none;
        }

        .user-info span {
            font-weight: 600;
            color: #2c3e50;
            margin-right: 15px;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 80px 20px 20px;
            display: none;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-header i {
            font-size: 1.8rem;
            margin-right: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-header h2 {
            font-size: 1.4rem;
            color: #2c3e50;
        }

        .quick-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .link-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .link-item:hover {
            transform: translateY(-3px);
            border-color: #667eea;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .link-item i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #667eea;
        }

        .link-item span {
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
        }

        .todo-section {
            max-height: 400px;
            overflow-y: auto;
        }

        .todo-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .todo-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .todo-input input:focus {
            outline: none;
            border-color: #667eea;
        }

        .todo-input button {
            padding: 12px 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.3s ease;
        }

        .todo-input button:hover {
            opacity: 0.9;
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .todo-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .todo-item input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.2);
            cursor: pointer;
        }

        .todo-item .todo-text {
            flex: 1;
            font-size: 1rem;
        }

        .todo-item .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .sheet-setup {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px dashed #667eea;
        }

        .sheet-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 15px;
            width: 100%;
            transition: background 0.3s ease;
        }

        .export-btn:hover {
            background: #218838;
        }

        .export-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .notes-area {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .notes-area:focus {
            outline: none;
            border-color: #667eea;
        }

        .save-notes-btn {
            margin-top: 10px;
            padding: 10px 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        .date-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #28a745;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            display: none;
            z-index: 1001;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translate(-50%, -20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }

        .password-strength {
            margin-top: 5px;
            font-size: 0.8rem;
        }

        .strength-weak { color: #e74c3c; }
        .strength-medium { color: #f39c12; }
        .strength-strong { color: #27ae60; }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .quick-links {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .auth-container {
                min-width: 300px;
                margin: 20px;
            }
            
            .container {
                padding: 80px 10px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Overlay -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-container">
            <!-- Login Form -->
            <div id="loginForm">
                <h2><i class="fas fa-sign-in-alt"></i> Login</h2>
                <input type="text" class="auth-input" id="loginUsername" placeholder="Username" autocomplete="username">
                <input type="password" class="auth-input" id="loginPassword" placeholder="Password" autocomplete="current-password">
                <button class="auth-btn" onclick="login()">Login</button>
                <div class="auth-links">
                    <a href="#" onclick="showSignup()">Create Account</a>
                    <a href="#" onclick="showForgot()">Forgot Password?</a>
                </div>
                <div class="error-message" id="loginError"></div>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" style="display:none;">
                <h2><i class="fas fa-user-plus"></i> Create Account</h2>
                <input type="text" class="auth-input" id="signupUsername" placeholder="Choose username (3-20 characters)" autocomplete="username">
                <input type="email" class="auth-input" id="signupEmail" placeholder="Email address" autocomplete="email">
                <input type="password" class="auth-input" id="signupPassword" placeholder="Choose password (min 8 characters)" autocomplete="new-password" oninput="checkPasswordStrength()">
                <div class="password-strength" id="passwordStrength"></div>
                <input type="password" class="auth-input" id="confirmPassword" placeholder="Confirm password" autocomplete="new-password">
                <button class="auth-btn" onclick="signup()">Create Account</button>
                <div class="auth-links">
                    <a href="#" onclick="showLogin()">Back to Login</a>
                </div>
                <div class="error-message" id="signupError"></div>
                <div class="success-message" id="signupSuccess"></div>
            </div>

            <!-- Forgot Password Form -->
            <div id="forgotForm" style="display:none;">
                <h2><i class="fas fa-key"></i> Reset Password</h2>
                <input type="text" class="auth-input" id="forgotUsername" placeholder="Enter username">
                <input type="email" class="auth-input" id="forgotEmail" placeholder="Enter email address">
                <input type="password" class="auth-input" id="newPassword" placeholder="New password (min 8 characters)" oninput="checkNewPasswordStrength()">
                <div class="password-strength" id="newPasswordStrength"></div>
                <button class="auth-btn" onclick="resetPassword()">Reset Password</button>
                <div class="auth-links">
                    <a href="#" onclick="showLogin()">Back to Login</a>
                </div>
                <div class="error-message" id="forgotError"></div>
                <div class="success-message" id="forgotSuccess"></div>
            </div>
        </div>
    </div>

    <!-- User Info Bar -->
    <div class="user-info" id="userInfo">
        <span id="currentUser"></span>
        <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>

    <!-- Main Content -->
    <div class="container" id="mainContent">
        <div class="header">
            <h1><i class="fas fa-play-circle"></i> THE ARS PLAYGROUND</h1>
            <p>Your secure, personalized productivity and entertainment hub</p>
        </div>

        <div class="dashboard">
            <!-- Work Links Section -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-briefcase"></i>
                    <h2>Work Links</h2>
                </div>
                <div class="quick-links">
                    <div class="link-item" onclick="openLink('https://parichay.nic.in/pnv1/assets/login?sid=eOfficeORGI')">
                        <i class="fas fa-building"></i>
                        <span>eOffice</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://accounts.mgovcloud.in/signin?servicename=VirtualOffice&serviceurl=https%3A%2F%2Fworkplace.mgovcloud.in%2F')">
                        <i class="fas fa-cloud"></i>
                        <span>Virtual Office</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://web.whatsapp.com/')">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://www.meta.ai/')">
                        <i class="fas fa-robot"></i>
                        <span>Meta AI</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://docs.google.com/forms/u/0/')">
                        <i class="fas fa-wpforms"></i>
                        <span>Google Forms</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://github.com/')">
                        <i class="fab fa-github"></i>
                        <span>GitHub</span>
                    </div>
                </div>
            </div>

            <!-- Social Media Section -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-share-alt"></i>
                    <h2>Social Media</h2>
                </div>
                <div class="quick-links">
                    <div class="link-item" onclick="openLink('https://facebook.com')">
                        <i class="fab fa-facebook"></i>
                        <span>Facebook</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://instagram.com')">
                        <i class="fab fa-instagram"></i>
                        <span>Instagram</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://twitter.com')">
                        <i class="fab fa-twitter"></i>
                        <span>Twitter</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://linkedin.com')">
                        <i class="fab fa-linkedin"></i>
                        <span>LinkedIn</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://youtube.com')">
                        <i class="fab fa-youtube"></i>
                        <span>YouTube</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://discord.com')">
                        <i class="fab fa-discord"></i>
                        <span>Discord</span>
                    </div>
                </div>
            </div>

            <!-- Personal To-Do with Google Sheets Integration -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-clipboard-list"></i>
                    <h2>Personal To-Do & Tasks</h2>
                </div>
                <div class="date-display" id="current-date"></div>
                
                <!-- Google Sheets Setup -->
                <div class="sheet-setup" id="sheetSetup">
                    <h4><i class="fas fa-table"></i> Setup Your Personal Google Sheet</h4>
                    <p style="margin-bottom: 10px; font-size: 0.9rem;">Enter your Google Apps Script Web App URL to sync tasks to your personal sheet:</p>
                    <input type="url" class="sheet-input" id="sheetUrl" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
                    <button onclick="saveSheetUrl()" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-save"></i> Save Sheet URL
                    </button>
                </div>

                <div class="todo-input">
                    <input type="text" id="todo-text" placeholder="Add today's task or note...">
                    <button onclick="addTodo()">Add</button>
                </div>
                <div class="todo-section" id="todo-list"></div>
                <button class="export-btn" onclick="exportToGoogleSheet()" id="exportBtn">
                    <i class="fas fa-upload"></i> Sync to My Google Sheet
                </button>
            </div>

            <!-- Personal Notes Section -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-sticky-note"></i>
                    <h2>Personal Notes</h2>
                </div>
                <textarea class="notes-area" id="personal-notes" placeholder="Write your personal notes here... (Auto-saves every 30 seconds)"></textarea>
                <button class="save-notes-btn" onclick="saveNotes()">
                    <i class="fas fa-save"></i> Save Notes
                </button>
            </div>

            <!-- Music & Entertainment -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-music"></i>
                    <h2>Music & Entertainment</h2>
                </div>
                <div class="quick-links">
                    <div class="link-item" onclick="openLink('https://www.jiosaavn.com')">
                        <i class="fas fa-music"></i>
                        <span>JioSaavn</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://open.spotify.com')">
                        <i class="fab fa-spotify"></i>
                        <span>Spotify</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://music.youtube.com')">
                        <i class="fab fa-youtube"></i>
                        <span>YouTube Music</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://netflix.com')">
                        <i class="fas fa-film"></i>
                        <span>Netflix</span>
                    </div>
                </div>
            </div>

            <!-- Games & Chess -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-gamepad"></i>
                    <h2>Games & Chess</h2>
                </div>
                <div class="quick-links">
                    <div class="link-item" onclick="openLink('https://chess.com')">
                        <i class="fas fa-chess-board"></i>
                        <span>Chess.com</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://lichess.org')">
                        <i class="fas fa-chess-knight"></i>
                        <span>Lichess</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://www.chess24.com')">
                        <i class="fas fa-chess-rook"></i>
                        <span>Chess24</span>
                    </div>
                    <div class="link-item" onclick="openLink('https://www.chess.org')">
                        <i class="fas fa-chess-king"></i>
                        <span>Chess.org</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Secure User Management System
        class SecureUserManager {
            constructor() {
                this.users = this.loadUsers();
                this.currentUser = null;
                this.sessionTimeout = 24 * 60 * 60 * 1000; // 24 hours
            }

            loadUsers() {
                try {
                    return JSON.parse(atob(localStorage.getItem('ars_users') || btoa('{}')));
                } catch {
                    return {};
                }
            }

            saveUsers() {
                localStorage.setItem('ars_users', btoa(JSON.stringify(this.users)));
            }

            hashPassword(password) {
                // Simple hash function for demo - in production use proper crypto
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32-bit integer
                }
                return hash.toString(36);
            }

            validateUsername(username) {
                return /^[a-zA-Z0-9_]{3,20}$/.test(username);
            }

            validateEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }

            validatePassword(password) {
                return password.length >= 8 && 
                       /[A-Z]/.test(password) && 
                       /[a-z]/.test(password) && 
                       /[0-9]/.test(password);
            }

            getPasswordStrength(password) {
                let strength = 0;
                if (password.length >= 8) strength++;
                if (/[a-z]/.test(password)) strength++;
                if (/[A-Z]/.test(password)) strength++;
                if (/[0-9]/.test(password)) strength++;
                if (/[^a-zA-Z0-9]/.test(password)) strength++;
                
                if (strength < 3) return { level: 'weak', text: 'Weak - Add uppercase, numbers, symbols' };
                if (strength < 4) return { level: 'medium', text: 'Medium - Good password' };
                return { level: 'strong', text: 'Strong - Excellent password!' };
            }

            createUser(username, email, password) {
                if (!this.validateUsername(username)) {
                    throw new Error('Username must be 3-20 characters, letters, numbers, and underscores only');
                }
                if (!this.validateEmail(email)) {
                    throw new Error('Please enter a valid email address');
                }
                if (!this.validatePassword(password)) {
                    throw new Error('Password must be at least 8 characters with uppercase, lowercase, and numbers');
                }
                if (this.users[username]) {
                    throw new Error('Username already exists. Please choose a different one.');
                }

                this.users[username] = {
                    email,
                    password: this.hashPassword(password),
                    created: Date.now(),
                    lastLogin: null,
                    sheetUrl: null
                };
                this.saveUsers();
                return true;
            }

            authenticateUser(username, password) {
                const user = this.users[username];
                if (!user || user.password !== this.hashPassword(password)) {
                    return false;
                }
                
                user.lastLogin = Date.now();
                this.saveUsers();
                this.currentUser = username;
                
                // Set session with expiration
                const session = {
                    username,
                    expires: Date.now() + this.sessionTimeout,
                    loginTime: Date.now()
                };
                localStorage.setItem('ars_session', btoa(JSON.stringify(session)));
                return true;
            }

            resetPassword(username, email, newPassword) {
                const user = this.users[username];
                if (!user || user.email !== email) {
                    throw new Error('Username and email do not match our records');
                }
                if (!this.validatePassword(newPassword)) {
                    throw new Error('Password must be at least 8 characters with uppercase, lowercase, and numbers');
                }

                user.password = this.hashPassword(newPassword);
                this.saveUsers();
                return true;
            }

            checkSession() {
                try {
                    const session = JSON.parse(atob(localStorage.getItem('ars_session') || '{}'));
                    if (session.expires && Date.now() < session.expires) {
                        this.currentUser = session.username;
                        return true;
                    }
                } catch {}
                
                this.logout();
                return false;
            }

            logout() {
                this.currentUser = null;
                localStorage.removeItem('ars_session');
            }

            getCurrentUser() {
                return this.currentUser;
            }

            getUserData(username) {
                return this.users[username] || null;
            }

            updateUserSheetUrl(username, sheetUrl) {
                if (this.users[username]) {
                    this.users[username].sheetUrl = sheetUrl;
                    this.saveUsers();
                    return true;
                }
                return false;
            }

            getUserSheetUrl(username) {
                const user = this.users[username];
                return user ? user.sheetUrl : null;
            }
        }

        // Personal Data Manager for each user
        class PersonalDataManager {
            constructor(username) {
                this.username = username;
                this.storageKey = `ars_data_${username}`;
            }

            getUserData() {
                try {
                    return JSON.parse(atob(localStorage.getItem(this.storageKey) || btoa('{}')));
                } catch {
                    return {};
                }
            }

            saveUserData(data) {
                localStorage.setItem(this.storageKey, btoa(JSON.stringify(data)));
            }

            getTodos() {
                const data = this.getUserData();
                return data.todos || {};
            }

            saveTodos(todos) {
                const data = this.getUserData();
                data.todos = todos;
                this.saveUserData(data);
            }

            getNotes() {
                const data = this.getUserData();
                return data.notes || {};
            }

            saveNotes(notes) {
                const data = this.getUserData();
                data.notes = notes;
                this.saveUserData(data);
            }
        }

        // Global instances
        let userManager = new SecureUserManager();
        let dataManager = null;
        let todos = {};

        // Authentication Functions
        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('forgotForm').style.display = 'none';
            clearMessages();
        }

        function showSignup() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'block';
            document.getElementById('forgotForm').style.display = 'none';
            clearMessages();
        }

        function showForgot() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('forgotForm').style.display = 'block';
            clearMessages();
        }

        function clearMessages() {
            document.querySelectorAll('.error-message, .success-message').forEach(el => {
                el.style.display = 'none';
                el.textContent = '';
            });
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function checkPasswordStrength() {
            const password = document.getElementById('signupPassword').value;
            const strengthDiv = document.getElementById('passwordStrength');
            
            if (password.length === 0) {
                strengthDiv.textContent = '';
                return;
            }

            const strength = userManager.getPasswordStrength(password);
            strengthDiv.textContent = strength.text;
            strengthDiv.className = `password-strength strength-${strength.level}`;
        }

        function checkNewPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthDiv = document.getElementById('newPasswordStrength');
            
            if (password.length === 0) {
                strengthDiv.textContent = '';
                return;
            }

            const strength = userManager.getPasswordStrength(password);
            strengthDiv.textContent = strength.text;
            strengthDiv.className = `password-strength strength-${strength.level}`;
        }

        function signup() {
            clearMessages();
            
            const username = document.getElementById('signupUsername').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!username || !email || !password || !confirmPassword) {
                showError('signupError', 'Please fill in all fields');
                return;
            }

            if (password !== confirmPassword) {
                showError('signupError', 'Passwords do not match');
                return;
            }

            try {
                userManager.createUser(username, email, password);
                showSuccess('signupSuccess', 'Account created successfully! Please login.');
                setTimeout(() => showLogin(), 2000);
            } catch (error) {
                showError('signupError', error.message);
            }
        }

        function login() {
            clearMessages();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                showError('loginError', 'Please enter both username and password');
                return;
            }

            try {
                if (userManager.authenticateUser(username, password)) {
                    initializeUserSession();
                } else {
                    showError('loginError', 'Invalid username or password');
                }
            } catch (error) {
                showError('loginError', 'Login failed. Please try again.');
            }
        }

        function resetPassword() {
            clearMessages();
            
            const username = document.getElementById('forgotUsername').value.trim();
            const email = document.getElementById('forgotEmail').value.trim();
            const newPassword = document.getElementById('newPassword').value;

            if (!username || !email || !newPassword) {
                showError('forgotError', 'Please fill in all fields');
                return;
            }

            try {
                userManager.resetPassword(username, email, newPassword);
                showSuccess('forgotSuccess', 'Password reset successfully! Please login.');
                setTimeout(() => showLogin(), 2000);
            } catch (error) {
                showError('forgotError', error.message);
            }
        }

        function logout() {
            userManager.logout();
            dataManager = null;
            todos = {};
            document.getElementById('authOverlay').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('userInfo').style.display = 'none';
            showLogin();
            showNotification('Logged out successfully', 'info');
        }

        function initializeUserSession() {
            const currentUser = userManager.getCurrentUser();
            dataManager = new PersonalDataManager(currentUser);
            
            // Show main content and user info
            document.getElementById('authOverlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('currentUser').textContent = `Welcome, ${currentUser}!`;
            
            // Load user data
            loadUserData();
            initializeApp();
            
            showNotification(`Welcome back, ${currentUser}!`, 'success');
        }

        function loadUserData() {
            const currentUser = userManager.getCurrentUser();
            todos = dataManager.getTodos();
            
            // Load user's sheet URL
            const sheetUrl = userManager.getUserSheetUrl(currentUser);
            if (sheetUrl) {
                document.getElementById('sheetUrl').value = sheetUrl;
                document.getElementById('sheetSetup').style.background = '#d4edda';
                document.getElementById('sheetSetup').innerHTML = `
                    <h4><i class="fas fa-check-circle" style="color: #28a745;"></i> Google Sheet Connected</h4>
                    <p style="margin-bottom: 10px; font-size: 0.9rem;">Your tasks will sync to your personal sheet.</p>
                    <input type="url" class="sheet-input" id="sheetUrl" value="${sheetUrl}" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
                    <button onclick="saveSheetUrl()" style="padding: 8px 15px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-save"></i> Update Sheet URL
                    </button>
                `;
            }
        }

        // App Initialization
        function initializeApp() {
            updateDate();
            loadTodos();
            loadNotes();
            
            // Update date every minute
            setInterval(updateDate, 60000);
            
            // Auto-save notes every 30 seconds
            setInterval(autoSaveNotes, 30000);
        }

        function updateDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', options);
        }

        // Todo Functions
        function addTodo() {
            const todoText = document.getElementById('todo-text');
            const text = todoText.value.trim();
            
            if (!text) {
                showNotification('Please enter a task', 'error');
                return;
            }

            const today = new Date().toDateString();
            if (!todos[today]) {
                todos[today] = [];
            }

            const todo = {
                id: Date.now(),
                text: text,
                completed: false,
                timestamp: new Date().toLocaleTimeString(),
                priority: 'medium'
            };

            todos[today].push(todo);
            dataManager.saveTodos(todos);
            todoText.value = '';
            loadTodos();
            showNotification('Task added successfully!', 'success');
        }

        function toggleTodo(todoId) {
            const today = new Date().toDateString();
            if (todos[today]) {
                const todo = todos[today].find(t => t.id === todoId);
                if (todo) {
                    todo.completed = !todo.completed;
                    dataManager.saveTodos(todos);
                    loadTodos();
                    showNotification(todo.completed ? 'Task completed!' : 'Task marked as pending', 'success');
                }
            }
        }

        function deleteTodo(todoId) {
            const today = new Date().toDateString();
            if (todos[today]) {
                todos[today] = todos[today].filter(t => t.id !== todoId);
                dataManager.saveTodos(todos);
                loadTodos();
                showNotification('Task deleted!', 'success');
            }
        }

        function loadTodos() {
            const today = new Date().toDateString();
            const todoList = document.getElementById('todo-list');
            
            if (!todos[today] || todos[today].length === 0) {
                todoList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No tasks for today. Add some tasks above!</p>';
                return;
            }

            todoList.innerHTML = todos[today].map(todo => `
                <div class="todo-item ${todo.completed ? 'completed' : ''}">
                    <input type="checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodo(${todo.id})">
                    <div class="todo-text">
                        <div style="font-weight: ${todo.completed ? 'normal' : '600'};">${todo.text}</div>
                        <small style="color: #666;">Added at ${todo.timestamp}</small>
                    </div>
                    <button class="delete-btn" onclick="deleteTodo(${todo.id})" title="Delete task">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        // Google Sheets Integration
        function saveSheetUrl() {
            const sheetUrl = document.getElementById('sheetUrl').value.trim();
            const currentUser = userManager.getCurrentUser();
            
            if (!sheetUrl) {
                showNotification('Please enter a valid Google Apps Script URL', 'error');
                return;
            }

            if (!sheetUrl.includes('script.google.com') || !sheetUrl.includes('/exec')) {
                showNotification('Please enter a valid Google Apps Script Web App URL', 'error');
                return;
            }

            if (userManager.updateUserSheetUrl(currentUser, sheetUrl)) {
                document.getElementById('sheetSetup').style.background = '#d4edda';
                document.getElementById('sheetSetup').innerHTML = `
                    <h4><i class="fas fa-check-circle" style="color: #28a745;"></i> Google Sheet Connected</h4>
                    <p style="margin-bottom: 10px; font-size: 0.9rem;">Your tasks will sync to your personal sheet.</p>
                    <input type="url" class="sheet-input" id="sheetUrl" value="${sheetUrl}" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
                    <button onclick="saveSheetUrl()" style="padding: 8px 15px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-save"></i> Update Sheet URL
                    </button>
                `;
                showNotification('Sheet URL saved successfully!', 'success');
            } else {
                showNotification('Failed to save sheet URL', 'error');
            }
        }

        function exportToGoogleSheet() {
            const currentUser = userManager.getCurrentUser();
            const sheetUrl = userManager.getUserSheetUrl(currentUser);
            
            if (!sheetUrl) {
                showNotification('Please setup your Google Sheet URL first', 'error');
                return;
            }

            const today = new Date().toDateString();
            const todayTodos = todos[today] || [];
            
            if (todayTodos.length === 0) {
                showNotification('No tasks to export for today', 'info');
                return;
            }

            const exportBtn = document.getElementById('exportBtn');
            exportBtn.disabled = true;
            exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Syncing...';

            // Prepare data for Google Sheets
            const tasksData = todayTodos.map(todo => ({
                date: today,
                time: todo.timestamp,
                task: todo.text,
                status: todo.completed ? 'Completed' : 'Pending',
                user: currentUser
            }));

            // Send to Google Sheets
            Promise.all(tasksData.map(task => 
                fetch(sheetUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(task),
                    mode: 'no-cors'
                })
            )).then(() => {
                showNotification('Tasks synced to your Google Sheet successfully!', 'success');
            }).catch(error => {
                console.error('Export error:', error);
                showNotification('Failed to sync to Google Sheet. Check your URL and try again.', 'error');
            }).finally(() => {
                exportBtn.disabled = false;
                exportBtn.innerHTML = '<i class="fas fa-upload"></i> Sync to My Google Sheet';
            });
        }

        // Notes Functions
        function saveNotes() {
            const notes = document.getElementById('personal-notes').value;
            const today = new Date().toDateString();
            const currentUser = userManager.getCurrentUser();
            
            const userNotes = dataManager.getNotes();
            userNotes[today] = notes;
            dataManager.saveNotes(userNotes);
            
            showNotification('Notes saved successfully!', 'success');
        }

        function loadNotes() {
            const today = new Date().toDateString();
            const userNotes = dataManager.getNotes();
            const todayNotes = userNotes[today] || '';
            document.getElementById('personal-notes').value = todayNotes;
        }

        function autoSaveNotes() {
            const notes = document.getElementById('personal-notes').value;
            if (notes.trim() && dataManager) {
                const today = new Date().toDateString();
                const userNotes = dataManager.getNotes();
                userNotes[today] = notes;
                dataManager.saveNotes(userNotes);
            }
        }

        // Utility Functions
        function openLink(url) {
            window.open(url, '_blank', 'noopener,noreferrer');
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            const colors = {
                success: '#28a745',
                error: '#dc3545',
                info: '#17a2b8',
                warning: '#ffc107'
            };
            
            notification.style.background = colors[type] || colors.success;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', function(e) {
            // Only work when main content is visible
            if (document.getElementById('mainContent').style.display === 'none') return;
            
            // Ctrl + Enter to add todo
            if (e.ctrlKey && e.key === 'Enter') {
                if (document.getElementById('todo-text') === document.activeElement) {
                    e.preventDefault();
                    addTodo();
                }
            }
            
            // Ctrl + S to save notes
            if (e.ctrlKey && e.key === 's') {
                if (document.getElementById('personal-notes') === document.activeElement) {
                    e.preventDefault();
                    saveNotes();
                }
            }

            // Ctrl + L to logout
            if (e.ctrlKey && e.key === 'l') {
                e.preventDefault();
                logout();
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (userManager.checkSession()) {
                initializeUserSession();
            } else {
                showLogin();
            }
        });

        // Session timeout warning
        setInterval(() => {
            if (userManager.getCurrentUser()) {
                try {
                    const session = JSON.parse(atob(localStorage.getItem('ars_session')));
                    const timeLeft = session.expires - Date.now();
                    
                    // Warn when 1 hour left
                    if (timeLeft < 60 * 60 * 1000 && timeLeft > 59 * 60 * 1000) {
                        showNotification('Session expires in 1 hour. Your work is auto-saved.', 'warning');
                    }
                } catch (e) {}
            }
        }, 60000); // Check every minute
    </script>
</body>
</html>
